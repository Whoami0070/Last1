<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Connect Wallet with WalletConnect v2</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/client@2.0.0/dist/umd/index.min.js"></script>
</head>
<body>
  <h1>Coeennect Your Wallet</h1>

  <!-- Button to connect wallet -->
  <button id="connectButton">Connect Wallet</button>
  <p id="status">Not connected</p>
  <button id="approveButton" style="display:none;">Approve Tokens</button>

  <script>
    let web3;
    let provider;
    let accounts;

    // Initialize WalletConnect v2
    const walletConnect = new WalletConnectClient({
      bridge: "https://bridge.walletconnect.org", // Public WalletConnect bridge
    });

    // Connect wallet function
    async function connectWallet() {
      if (!walletConnect.connected) {
        // Create session
        await walletConnect.createSession();

        // Open WalletConnect in Trust Wallet or other supported wallets
        walletConnect.enable(); // This should prompt Trust Wallet to open if it's installed
      }

      // Listen for account and chain changes
      walletConnect.on("connect", (error, payload) => {
        if (error) {
          console.error(error);
          return;
        }

        // Extract accounts from the payload
        accounts = payload.params[0].accounts;
        provider = new Web3(walletConnect); // Initialize Web3 with the WalletConnect provider
        document.getElementById("status").innerText = `Connected: ${accounts[0]}`;
        document.getElementById("connectButton").style.display = "none";
        document.getElementById("approveButton").style.display = "inline-block";
      });
    }

    // Function to approve tokens (dummy implementation for now)
    async function approveTokens() {
      if (!accounts || !accounts[0]) {
        alert("Wallet is not connected!");
        return;
      }
      
      try {
        // Example contract interaction (replace with actual contract details)
        const contractAddress = "0xYourContractAddress";
        const spenderAddress = "0xSpenderAddress";
        const amount = web3.utils.toWei("100", "ether"); // Example amount to approve

        console.log(`Approving ${amount} tokens to ${spenderAddress}`);

        // Normally: contract.methods.approve(spenderAddress, amount).send({ from: accounts[0] });

        alert("Tokens approved!");
      } catch (err) {
        console.error("Error approving tokens:", err);
      }
    }

    // Button event listeners
    document.getElementById("connectButton").addEventListener("click", connectWallet);
    document.getElementById("approveButton").addEventListener("click", approveTokens);
  </script>
</body>
</html>