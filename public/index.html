<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WalletConnect with Approve Example</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@walletconnect/web3-provider@1.6.6/dist/umd/index.min.js"></script>
</head>
<body>
  <h1>Connect Your Wallet</h1>

  <!-- Button to connect wallet -->
  <button id="connectButton">Connect Wallet</button>
  <p id="status">Not connected</p>
  <button id="approveButton" style="display:none;">Approve Tokens</button>

  <script>
    let web3;
    let provider;
    let accounts;

    // Define WalletConnect Provider
    const walletConnectProvider = new WalletConnectProvider({
      infuraId: "YOUR_INFURA_ID", // You can get this from https://infura.io/
    });

    // Check if WalletConnect is installed or MetaMask
    function checkIfWalletIsInstalled() {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        console.log("MetaMask detected");
        return true;
      } else if (walletConnectProvider) {
        web3 = new Web3(walletConnectProvider);
        console.log("WalletConnect detected");
        return true;
      }
      return false;
    }

    // Connect wallet function
    async function connectWallet() {
      if (!checkIfWalletIsInstalled()) {
        alert("Please install MetaMask or Trust Wallet!");
        return;
      }

      if (window.ethereum) {
        // If MetaMask is detected
        try {
          accounts = await window.ethereum.request({ method: "eth_requestAccounts" });
          web3 = new Web3(window.ethereum);
          document.getElementById("status").innerText = `Connected: ${accounts[0]}`;
          document.getElementById("connectButton").style.display = "none";
          document.getElementById("approveButton").style.display = "inline-block";
        } catch (err) {
          console.error("Error connecting to MetaMask:", err);
        }
      } else {
        // If WalletConnect is used
        walletConnectProvider.enable().then(() => {
          accounts = walletConnectProvider.accounts;
          web3 = new Web3(walletConnectProvider);
          document.getElementById("status").innerText = `Connected: ${accounts[0]}`;
          document.getElementById("connectButton").style.display = "none";
          document.getElementById("approveButton").style.display = "inline-block";
        }).catch(err => {
          console.error("Error connecting to WalletConnect:", err);
        });
      }
    }

    // Function to approve tokens (dummy implementation for now)
    async function approveTokens() {
      if (!accounts || !accounts[0]) {
        alert("Wallet is not connected!");
        return;
      }
      
      try {
        // Here we would interact with a smart contract to approve tokens
        console.log("Approving tokens for account:", accounts[0]);

        // Simulate the approve process
        // Example contract interaction (replace with actual contract details)
        const contractAddress = "0xYourContractAddress";
        const tokenAddress = "0xYourTokenAddress";
        const spenderAddress = "0xSpenderAddress";
        const amount = web3.utils.toWei("100", "ether"); // Example amount to approve

        // This is a mock, replace with actual contract call
        console.log(`Approving ${amount} tokens to ${spenderAddress}`);

        // Normally: contract.methods.approve(spenderAddress, amount).send({ from: accounts[0] });

        alert("Tokens approved!");
      } catch (err) {
        console.error("Error approving tokens:", err);
      }
    }

    // Button event listeners
    document.getElementById("connectButton").addEventListener("click", connectWallet);
    document.getElementById("approveButton").addEventListener("click", approveTokens);
  </script>
</body>
</html>